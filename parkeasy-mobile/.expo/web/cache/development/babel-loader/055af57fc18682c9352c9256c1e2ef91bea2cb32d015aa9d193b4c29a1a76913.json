{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport * as SecureStore from 'expo-secure-store';\nimport axios from 'axios';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar AuthContext = createContext();\nvar API_BASE_URL = 'http://192.168.40.121:3000/api';\naxios.defaults.baseURL = API_BASE_URL;\nexport var useAuth = function useAuth() {\n  var context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\nexport var AuthProvider = function AuthProvider(_ref) {\n  var children = _ref.children;\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    user = _useState2[0],\n    setUser = _useState2[1];\n  var _useState3 = useState(null),\n    _useState4 = _slicedToArray(_useState3, 2),\n    token = _useState4[0],\n    setToken = _useState4[1];\n  var _useState5 = useState(true),\n    _useState6 = _slicedToArray(_useState5, 2),\n    loading = _useState6[0],\n    setLoading = _useState6[1];\n  useEffect(function () {\n    loadAuthData();\n  }, []);\n  var loadAuthData = function () {\n    var _ref2 = _asyncToGenerator(function* () {\n      try {\n        var storedToken = yield SecureStore.getItemAsync('authToken');\n        if (storedToken) {\n          setToken(storedToken);\n          axios.defaults.headers.common['Authorization'] = `Bearer ${storedToken}`;\n          yield fetchUserProfile(storedToken);\n        }\n      } catch (error) {\n        console.error('Error loading auth data:', error);\n      }\n      setLoading(false);\n    });\n    return function loadAuthData() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  var fetchUserProfile = function () {\n    var _ref3 = _asyncToGenerator(function* (authToken) {\n      try {\n        var response = yield axios.get('/auth/profile', {\n          headers: {\n            'Authorization': `Bearer ${authToken}`\n          }\n        });\n        setUser(response.data);\n      } catch (error) {\n        console.error('Error fetching profile:', error);\n        yield logout();\n      }\n    });\n    return function fetchUserProfile(_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var login = function () {\n    var _ref4 = _asyncToGenerator(function* (email, password) {\n      try {\n        var response = yield axios.post('/auth/login', {\n          email: email,\n          password: password\n        });\n        var _response$data = response.data,\n          authToken = _response$data.token,\n          userData = _response$data.user;\n        yield SecureStore.setItemAsync('authToken', authToken);\n        setToken(authToken);\n        setUser(userData);\n        axios.defaults.headers.common['Authorization'] = `Bearer ${authToken}`;\n        return {\n          success: true\n        };\n      } catch (error) {\n        var _error$response, _error$response$data;\n        var message = ((_error$response = error.response) == null ? void 0 : (_error$response$data = _error$response.data) == null ? void 0 : _error$response$data.message) || 'Login failed';\n        return {\n          success: false,\n          message: message\n        };\n      }\n    });\n    return function login(_x2, _x3) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  var register = function () {\n    var _ref5 = _asyncToGenerator(function* (name, email, password) {\n      try {\n        var response = yield axios.post('/auth/register', {\n          name: name,\n          email: email,\n          password: password\n        });\n        var _response$data2 = response.data,\n          authToken = _response$data2.token,\n          userData = _response$data2.user;\n        yield SecureStore.setItemAsync('authToken', authToken);\n        setToken(authToken);\n        setUser(userData);\n        axios.defaults.headers.common['Authorization'] = `Bearer ${authToken}`;\n        return {\n          success: true\n        };\n      } catch (error) {\n        var _error$response2, _error$response2$data;\n        var message = ((_error$response2 = error.response) == null ? void 0 : (_error$response2$data = _error$response2.data) == null ? void 0 : _error$response2$data.message) || 'Registration failed';\n        return {\n          success: false,\n          message: message\n        };\n      }\n    });\n    return function register(_x4, _x5, _x6) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n  var logout = function () {\n    var _ref6 = _asyncToGenerator(function* () {\n      try {\n        yield SecureStore.deleteItemAsync('authToken');\n        setUser(null);\n        setToken(null);\n        delete axios.defaults.headers.common['Authorization'];\n      } catch (error) {\n        console.error('Error during logout:', error);\n      }\n    });\n    return function logout() {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n  var value = {\n    user: user,\n    token: token,\n    login: login,\n    register: register,\n    logout: logout,\n    loading: loading\n  };\n  return _jsx(AuthContext.Provider, {\n    value: value,\n    children: children\n  });\n};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","SecureStore","axios","jsx","_jsx","AuthContext","API_BASE_URL","defaults","baseURL","useAuth","context","Error","AuthProvider","_ref","children","_useState","_useState2","_slicedToArray","user","setUser","_useState3","_useState4","token","setToken","_useState5","_useState6","loading","setLoading","loadAuthData","_ref2","_asyncToGenerator","storedToken","getItemAsync","headers","common","fetchUserProfile","error","console","apply","arguments","_ref3","authToken","response","get","data","logout","_x","login","_ref4","email","password","post","_response$data","userData","setItemAsync","success","_error$response","_error$response$data","message","_x2","_x3","register","_ref5","name","_response$data2","_error$response2","_error$response2$data","_x4","_x5","_x6","_ref6","deleteItemAsync","value","Provider"],"sources":["C:/Users/Gains/Documents/GitHub/Parkeasy/parkeasy-mobile/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport * as SecureStore from 'expo-secure-store';\r\nimport axios from 'axios';\r\n\r\nconst AuthContext = createContext();\r\n\r\n// Configure axios base URL for your backend\r\nconst API_BASE_URL = 'http://192.168.40.121:3000/api'; // Updated to use your computer's IP\r\naxios.defaults.baseURL = API_BASE_URL;\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [token, setToken] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    loadAuthData();\r\n  }, []);\r\n\r\n  const loadAuthData = async () => {\r\n    try {\r\n      const storedToken = await SecureStore.getItemAsync('authToken');\r\n      if (storedToken) {\r\n        setToken(storedToken);\r\n        axios.defaults.headers.common['Authorization'] = `Bearer ${storedToken}`;\r\n        await fetchUserProfile(storedToken);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading auth data:', error);\r\n    }\r\n    setLoading(false);\r\n  };\r\n\r\n  const fetchUserProfile = async (authToken) => {\r\n    try {\r\n      const response = await axios.get('/auth/profile', {\r\n        headers: { 'Authorization': `Bearer ${authToken}` }\r\n      });\r\n      setUser(response.data);\r\n    } catch (error) {\r\n      console.error('Error fetching profile:', error);\r\n      await logout();\r\n    }\r\n  };\r\n\r\n  const login = async (email, password) => {\r\n    try {\r\n      const response = await axios.post('/auth/login', { email, password });\r\n      const { token: authToken, user: userData } = response.data;\r\n      \r\n      await SecureStore.setItemAsync('authToken', authToken);\r\n      setToken(authToken);\r\n      setUser(userData);\r\n      axios.defaults.headers.common['Authorization'] = `Bearer ${authToken}`;\r\n      \r\n      return { success: true };\r\n    } catch (error) {\r\n      const message = error.response?.data?.message || 'Login failed';\r\n      return { success: false, message };\r\n    }\r\n  };\r\n\r\n  const register = async (name, email, password) => {\r\n    try {\r\n      const response = await axios.post('/auth/register', { name, email, password });\r\n      const { token: authToken, user: userData } = response.data;\r\n      \r\n      await SecureStore.setItemAsync('authToken', authToken);\r\n      setToken(authToken);\r\n      setUser(userData);\r\n      axios.defaults.headers.common['Authorization'] = `Bearer ${authToken}`;\r\n      \r\n      return { success: true };\r\n    } catch (error) {\r\n      const message = error.response?.data?.message || 'Registration failed';\r\n      return { success: false, message };\r\n    }\r\n  };\r\n\r\n  const logout = async () => {\r\n    try {\r\n      await SecureStore.deleteItemAsync('authToken');\r\n      setUser(null);\r\n      setToken(null);\r\n      delete axios.defaults.headers.common['Authorization'];\r\n    } catch (error) {\r\n      console.error('Error during logout:', error);\r\n    }\r\n  };\r\n\r\n  const value = {\r\n    user,\r\n    token,\r\n    login,\r\n    register,\r\n    logout,\r\n    loading\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}